{{- $params := .Params | merge .Site.Params.page -}}

<article class="single summary" itemscope itemtype="http://schema.org/Article">
    {{- /* Featured image */ -}}
    {{- $image := $params.featuredimagepreview | default $params.featuredimage -}}
    {{- with .Resources.GetMatch "featured-image" -}}
        {{- $image = .RelPermalink -}}
    {{- end -}}
    {{- with .Resources.GetMatch "featured-image-preview" -}}
        {{- $image = .RelPermalink -}}
    {{- end -}}
    {{- with $image -}}
        <div class="featured-image-preview">
            <a href="{{ $.RelPermalink }}">
                {{- dict "Src" . "Title" $.Description "Resources" $.Resources | partial "plugin/image.html" -}}
            </a>
        </div>
    {{- end -}}

    {{- /* Title */ -}}
    <h1 class="single-title" itemprop="name headline">
        <a href="{{ .RelPermalink }}">{{ .Title }}</a>
    </h1>

    {{- /* Summary content */ -}}
    <div class="content">
        {{- with .Summary -}}
            {{- dict "Content" . "Ruby" $params.ruby "Fraction" $params.fraction "Fontawesome" $params.fontawesome | partial "function/content.html" | safeHTML -}}
        {{- else -}}
            {{- .Description | safeHTML -}}
        {{- end -}}
    </div>

<div id='mapid_{{ $.Page.Params.title }}' class="leaflet-map" style='width: 100%; height: 500px;'></div>

<script>
    //Create Map
    leafletMapsObj[{{ $.Page.Params.title }}] = L.map('mapid_{{ $.Page.Params.title }}').setView(["", ""], 13);
    //Add tiles
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
    }).addTo(leafletMapsObj[{{ $.Page.Params.title }}]);

</script>
<script>
    trackOpts = {
        mapId: "{{ $.Page.Params.title }}",
        trackId: "{{ $.Page.Params.title }}",
        trackPath: '{{ "gpx" | absURL }}/{{$.Page.Params.gpx}}',
        lineColor: "#3796bf",
        lineWeight: "5",
        lineOpacity: "1"
    };
    elevationOpts = {
        graphPosition: "topright",
        graphTheme: "steelblue-theme",
        graphWidth: "500",
        graphHeight: "150",
        graphFollowMarker: false,
        graphCollapsed: true,
        graphDetached: false
    };
    markerOpts = {
        icon: "fa-thumb-tack",
        iconColor: "cyan",
        iconShape: "penta",
        iconClasses: "fa-icon-marker",
        iconStart: "fa-play",
        iconStartColor: "green-light",
        iconStartShape: "circle",
        iconStartClasses: "fa-icon-marker fa-icon-start-stop",
        iconEnd: "fa-flag-checkered",
        iconEndColor: "red",
        iconEndShape: "circle",
        iconEndClasses: "fa-icon-marker fa-icon-start-stop"
    };
    drawTrack(trackOpts, elevationOpts, markerOpts);
</script>

<div class="download-track" onclick="downloadFile('{{ "gpx" | absURL }}/{{ $.Page.Params.gpx }}');"><p class="download-track-link">Download</p></div>

    {{- /* Footer */ -}}
    <div class="post-footer">
        <a href="{{ .RelPermalink }}">{{ T "readMore" }} {{ .Params.title }}</a>
        {{- with .Params.tags -}}
            <div class="post-tags">
                <i class="fas fa-tags fa-fw"></i>&nbsp;
                {{- range $index, $value := . -}}
                    {{- if gt $index 0 }},&nbsp;{{ end -}}
                    {{- $tag := partialCached "function/path.html" $value $value | printf "/tags/%v" | $.Site.GetPage -}}
                    <a href="{{ $tag.RelPermalink }}">{{ $tag.Title }}</a>
                {{- end -}}
            </div>
        {{- end -}}
    </div>
</article>
